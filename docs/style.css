/* v42 CSS for History Timeline */
:root {
    --bg: #0b0b0c;
    --fg: #e6e6e6;
    --muted: #9aa0a6;
    --accent: #ff8c42;
    --card: #1a1b1e;
    --cardText: #ffffff;
    --footer-h: 16px;        /* v33: footerin vakiokorkeus */
    --header-h: 56px;    /* vakiokorkeusotsikolle, yliajetaan JS:llä */
}

* {
    box-sizing: border-box;
}

html,
body {
    margin: 0;
    padding: 0;
    height: 100%;
    /* v38: EI 100dvh → iOS Chromen bugit pois */
    overscroll-behavior: none;
    font-family: sans-serif;
    background: #6b6a6a;
    color: #ddd;
    overflow: hidden;
    /* ei pystyscrollia */
    -webkit-overflow-scrolling: touch;
}

#page-title {
    margin: 0.4em 1em 0em 1em; /* top right bottom left */
    padding-right: 30px;
    /* varaa tila ?-ikonille (24px koko + ~12–20px väli) */
    padding-bottom: 0.8em;
        /* "rivi tyhjää" mittautuu oikein */
    font-size: 1.12em;
    font-weight: 300;
    font-stretch: 85%;
    letter-spacing: 0.2px;
}

/* v38: jos muuttuvat fontit käytössä (esim. Inter), kavennetaan vielä */
@supports (font-variation-settings: normal) {
    #page-title {
        font-variation-settings: "wght" 320, "wdth" 85;
    }
}

#info-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 2000;
    /* yli kaiken, myös svg */
    cursor: pointer;
    font-size: 14px;
    font-weight: 700;
    color: #e49a45bc;
    width: 30px;
    height: 30px;
    /* hitbox hieman suurempi */
    line-height: 30px;
    text-align: center;
    border-radius: 8px;

    /* läpikuultava oranssi badge */
    background: rgba(255, 138, 66, 0.167);
    /* “accent” ~ #ff8c42, 28% */
    border: 1px solid rgba(255, 138, 66, 0.119);
    box-shadow:
        0 2px 6px rgba(0, 0, 0, 0.139),
        0 0 0 2px rgba(255, 140, 66, 0.12) inset;
    /* ohut hehku */
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

#info-box {
    position: absolute;
    top: 50px;
    right: 10px;
    display: none;
    max-width: 240px;
    padding: 8px 12px;
    background: rgba(40, 40, 40, 0.85);
    border: 1px solid #555;
    border-radius: 8px;
    font-size: 11px;
    line-height: 1.4;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

#info-box em {
    /* v38: korjattu virheellinen sisäkkäisyys */
    font-style: italic;
    font-weight: 400;
}

/* v38: info-box linkkien värit tummalla taustalla, hyvä kontrasti */
#info-box a {
    color: #89723b;
    /* lämmin keltainen/oranssi */
    text-decoration-thickness: 1.5px;
}

#info-box a:hover {
    color: #FFB703;
    /* kirkkaampi hover */
}

#info-box a:visited {
    color: #c6b291;
    /* hivenen tummempi visited */
}

#info-box a:focus-visible {
    outline: 2px solid #FFB703;
    /* näppis-/kosk. fokus näkyy */
    outline-offset: 2px;
    border-radius: 3px;
}

#timeline-container {
    position: fixed;
    /* v38.fix: täyttää ruudun ilman vh/dvh-ongelmaa */
    inset: calc(env(safe-area-inset-top) + var(--header-h)) 8px calc(env(safe-area-inset-bottom) + var(--footer-h)) 8px;
    /* top right bottom left */
    height: auto;
    /* ei korkeuden laskentaa → selainpalkit eivät sotke */
    margin: 0;
    background: #474646;
    border: 1px solid #211f1f;
    border-radius: 6px;
    overflow: hidden;
}

#timeline {
    width: 100%;
    height: 100%;
    display: block;
    touch-action: pan-y pinch-zoom;  /* allow native pinch; we handle horizontal swipe ourselves */
}

#page-footer {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: var(--footer-h);
    line-height: var(--footer-h);    /* vakio rivikorkeus */
    display: block;
    text-align: center;
    padding: 0 8px;
    margin: 0;
    background: transparent;
    backdrop-filter: none;
    border-top: none;
    font-size: 8px;
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;    /* ei rivinvaihtoa */
    padding-bottom: calc(env(safe-area-inset-bottom, 0px));    /* v37: ettei teksti jää loven alle */
}

/* Kortit ja akselit */
.axis line,
.axis path {
    stroke: #bbbaba;
}

.axis text {
    fill: #c9c9c9;
    font-size: 11px;
}
/* v36: major-tickien viivat selkeämmiksi, mutta hillityt */
.axis .tick line {
    stroke: #cfcfcf;
    stroke-opacity: 0.7;
    stroke-width: 1;
}
.minor-grid line {
    stroke: #d4d3d3;
    stroke-opacity: 0.75;    /* selvästi himmeämpi kuin major */
    shape-rendering: crispEdges;
}

.zoomBar .track {
    fill: #999;
    opacity: 0.1;    /* haalea tausta */
    pointer-events: none; /* ei blokkaa mitään */
}

/* v36: ikkuna ei peitä sisältöä — kevyempi & klikit läpi */
.zoomBar .window {
    fill: var(--accent);
    opacity: 0.25;
    stroke: var(--accent);
    pointer-events: none;
    /* varmistetaan ettei nappaa klikkejä */
}

g.card rect {
    /* fill comes from JS (d.color); keep it untouched */
    stroke: #474646;
    /* match the timeline container background for better blend */
    stroke-opacity: 0.35;
    /* soften the edge to “melt” into background */
    stroke-width: 1.5px;
    rx: 8;
    ry: 8;
    vector-effect: non-scaling-stroke;
    transition: fill-opacity .35s ease, stroke-opacity .35s ease, filter .35s ease;
}
g.card.active rect {
    fill-opacity: 0.85;
    /* emphasis without a harsh outline */
    stroke-opacity: 0.42;
    /* slightly stronger than passive, still subtle */
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, .25));
}

.card-group text {
    fill: #c2c0c0;
    font-size: 10px;
}

/* v35: vielä pienempi mobiilissa */
@media (max-width: 480px) {
    .card-group text.event-label {
        font-size: 8px;
    }
}

.event-label {
    fill: #dedede;
    /* tapahtumien tekstit */
    font-family: Georgia, "Times New Roman", serif;
    /* pakota serif */
        font-size: 9px;
            /* pienempi desktopilla */
            letter-spacing: .1px;
            /* pieni luettavuus-tweak */
}
/* v44: smooth neighbor easing for labels (prefocus offset) */
g.cards text.event-label {
    transition: transform 160ms ease-out;
    will-change: transform;
}

/* optional: respect reduced-motion */
@media (prefers-reduced-motion: reduce) {
    g.cards text.event-label {
        transition: none;
    }
}

.card-title {
    fill: #d7d5d5;    /* teemojen otsikot korteissa */
    font-weight: bold;
}

@media (max-width: 480px) {
    #page-title {
        font-size: 1.1em;
    }

    .axis text,
    .card-group text {
        font-size: 11px;
    }}

body {
    display: flex;
    flex-direction: column;
    min-height: 100dvh;
}

#plot-rect {
    fill: none !important;
    stroke: none !important;
}

/* v36: globaali haalennuskerros */
.global-dim-rect {
    fill: #bcbbbb;
    opacity: 0;
    /* näkyy vain kun activeTheme on */
    pointer-events: none;
    /* klikkaukset menevät läpi passiivisiin kortteihin */
    transition: opacity .12s ease;
}
/* v37: vakiohimmennys korttiryhmille, ei kerry zoomissa */
.card-group.inactive {
    opacity: 1 !important;
    /* estä opasitin kertautuminen */
    filter: brightness(0.55);
    /* tasainen tumma, ei riipu zoomista */
}
/* v41: smoother GPU-friendly transition for all card groups */
.card-group {
    will-change: filter;
    transition: filter 160ms ease;
}

/* v41: stronger fog tier for background cards */
.card-group.background {
    opacity: 1 !important;
    /* do not stack opacity */
    filter: brightness(0.62) saturate(0.90);
}

/* v41: keep active crisp; rely on filter, not opacity */
.card-group.active {
    filter: none;
    /* crisp, no dimming */
    isolation: isolate;
    /* keep on top in stacking contexts */
}

.card-group.inactive .card {
    fill-opacity: 1;
    /* vältetään fill-opacity * filter -kertaantuminen */
}
/* v40: Dim only inactive cards; no global wash over empty background */
g.card.inactive {
    opacity: 1 !important;
    /* don't compound with child opacities */
    filter: brightness(0.55);
}

g.card.inactive rect {
    fill-opacity: 1;
    /* prevent double-dimming with fill-opacity */
}

/* v41: even softer edge for background tier */
.card-group.background g.card rect {
    stroke-opacity: 0.12;
    /* EN: strongest fade */
    stroke-width: 0.5px;
    filter: none;
}
/* v41: fade the border on INACTIVE cards (your CSS uses 'inactive') */
.card-group.inactive g.card rect,
g.card.inactive rect {
    /* EN: match container hue and make it extremely subtle so brightness() won't pop it */
    stroke: #474646;
    /* same as #timeline-container background */
    stroke-opacity: 0.08;
    /* very low visibility */
    stroke-width: 0.5px;
    /* thinner non-scaling edge */
    filter: none;
    /* remove local halo on inactive */
}

/* v38: estä iOS/Android copy/select/callout aikajanan alueella */
#timeline-container,
#timeline,
#timeline * {
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
    /* iOS long-press menu pois */
    -webkit-tap-highlight-color: transparent;
    /* poista sininen highlight */
}

/* jätä infolaatikon tekstit valittaviksi */
#info-box,
#info-box * {
    -webkit-user-select: text;
    user-select: text;
    -webkit-touch-callout: default;
}
/* v40: Zoom bar is indicator-only; let all input pass through it */
svg .zoomBar,
svg .zoomBar .track,
svg .zoomBar .window,
svg .zoomBar .hit {
    pointer-events: none;
}

/* v41: animation touch cursor (Chrome DevTools -tyylinen) */
#touch-cursor {
    position: fixed;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(252, 170, 63, 0.689);
    box-shadow:
        0 0 0 10px rgba(255, 255, 255, 0.10),
        0 1px 6px rgba(0, 0, 0, .35);
    z-index: 1700;
    pointer-events: none;
    opacity: 0;
    transform: translate(-9px, -9px);
    /* keskitys pisteeseen */
    transition:
        opacity .50s ease,
        left .60s cubic-bezier(.2, .8, .2, 1),
        top .60s cubic-bezier(.2, .8, .2, 1);
}

.touch-ripple {
    position: fixed;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.45);
    pointer-events: none;
    z-index: 1699;
    opacity: 0.85;
    transform: translate(-14px, -14px) scale(0.6);
    animation: ripple-pop .45s ease-out forwards;
}

@keyframes ripple-pop {
    to {
        opacity: 0;
        transform: translate(-14px, -14px) scale(1.25);
    }
}

@media (prefers-reduced-motion: reduce) {

    #touch-cursor,
    .touch-ripple {
        transition: none !important;
        animation: none !important;
    }
}

/* v42 fix: ensure all SVG children under #timeline allow only vertical pan,
   so horizontal gestures are free for our custom zoom logic even on cards */
#timeline,
#timeline * {
    touch-action: pan-y;
}
/* v41: lock native scrolling during gesture (zoom or pan) */
#timeline.gesture-active,
#timeline-container.gesture-active {
    touch-action: none;
    overscroll-behavior: contain;
}

/* v42: center zoom indicator visuals (accent-colored, dashed) */
.centerZoomLine {
    stroke: var(--accent);
    /* use theme accent (e.g., #ff8c42) */
    stroke-opacity: 0.85;
    /* light, not too strong */
    stroke-width: 1;
    stroke-dasharray: 2 4;
    /* dashed hairline */
    stroke-linecap: butt;
    /* crisp dashes */
    shape-rendering: crispEdges;
    pointer-events: none;
    /* purely visual */
}

.centerZoomLabel {
    fill: var(--accent);
    /* match the line color */
    fill-opacity: 0.7;
    font-size: 14px;
    font-family: sans-serif;
    text-anchor: middle;
    dominant-baseline: central;
    pointer-events: none;
    /* purely visual */
    /* subtle readability halo without heavy shadow */
    paint-order: stroke;
    /* paint outline underneath */
    stroke: rgba(0, 0, 0, 0.35);
    /* soft outline for contrast */
    stroke-width: 0.6px;
    stroke-linejoin: round;
}

/* optional future-use: the pad is invisible and does NOT catch input yet */
.centerZoomPad {
    fill: transparent;
    pointer-events: none;
    /* keep off for now */
    /* If/when you want the pad to handle zoom-only input, switch to:
     pointer-events: all; touch-action: none; */
}
/* v42: continuous focus highlight for the nearest-to-center EVENT (label only) *//* v43.2: Bigger, smoother pre-focus highlight */
text.event-label.prefocus {
    font-size: 13.5px;          /* was 12px */
    font-weight: 800;           /* bolder */
    letter-spacing: 0.25px;
    /* Use transform for smooth scaling without layout jumps */
    transform: scale(1.12);
    transform-box: fill-box;    /* scale around the text's own box */
    transform-origin: 0% 50%;   /* left-center keeps label aligned to tick */
    /* Softer, longer ease-out */
    transition: transform .18s ease-out,
                font-size .18s ease-out,
                letter-spacing .18s ease-out,
                stroke-width .18s ease-out;
    /* Slightly stronger readability outline */
    paint-order: stroke;
    stroke: rgba(0,0,0,0.40);
    stroke-width: 0.9px;        /* was 0.6px */
}

/* v43.2: Also highlight the horizontal event marker line for the prefocused item */
g.e.is-prefocus line.event-line {
    stroke: var(--accent);
    stroke-width: 2px;          /* thicker line under the focused label */
    opacity: 0.95;
    transition: stroke-width .18s ease-out, opacity .18s ease-out;
}
text.event-label {
    transition: transform 380ms ease-out;
    will-change: transform;
}
/* v42.3: Event "More info" popover (animated) */
#event-info {
    position: fixed;
    z-index: 2200;
    max-width: min(320px, 60vw);
    padding: 10px 12px;
    font-size: 12px;
    line-height: 1.45;
    color: #eee;
    background: rgba(28, 28, 30, 0.96);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 10px;
    box-shadow: 0 8px 22px rgba(0, 0, 0, .45);

    /* animation states (hidden by default) */
    opacity: 0;
    transform: translateY(6px) scale(0.98);
    pointer-events: none;
    visibility: hidden;
    transition: opacity 140ms ease-out, transform 160ms ease-out, visibility 0s linear 160ms;
}

/* visible state */
#event-info.is-visible {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
    visibility: visible;
    transition: opacity 140ms ease-out, transform 160ms ease-out, visibility 0s;
}

#event-info .title {
    font-weight: 700;
    margin-bottom: 4px;
    color: #ffd399;
}

#event-info .meta {
    font-size: 11px;
    color: #c8c8c8;
    opacity: .9;
    margin-bottom: 6px;
}

#event-info .body {
    white-space: pre-wrap;
    color: #eaeaea;
}

#event-info .hint {
    margin-top: 8px;
    font-size: 10px;
    color: #9aa0a6;
}

#event-info a {
    color: #ffb703;
    text-decoration-thickness: 1.5px;
}

#event-info a:visited {
    color: #d1b67e;
}

/* Respect reduced-motion */
@media (prefers-reduced-motion: reduce) {

    #event-info,
    #event-info.is-visible {
        transition: none;
    }
}
/* --- Present Overlay (v45) --- */
.present-overlay .present-line {
    stroke: var(--present-stroke, #00bcd4);
    stroke-width: 1.5;
    vector-effect: non-scaling-stroke;
    /* stays thin at any zoom */
    opacity: 0.9;
}

.present-overlay .present-label {
    font-size: 11px;
    fill: var(--present-text, #00bcd4);
    text-shadow:
        0 1px 0 rgba(0, 0, 0, 0.25),
        0 -1px 0 rgba(0, 0, 0, 0.25);
    pointer-events: none;
}